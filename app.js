(()=>{"use strict";var t={8435:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getBoardButtons=void 0;const o=n(8118),r=n(9731);e.getBoardButtons=function(t,e){return i(this,void 0,void 0,(function*(){if(!(yield(0,o.isCurrentMemberAdmin)(t)))return[];const n=yield(0,r.isVotingLocked)(t);return[{text:n?"Unlock Voting":"Lock Voting",icon:{dark:n?e.images.lockedWhite:e.images.unlockedWhite,light:n?e.images.lockedBlack:e.images.unlockedWhite},callback:function(t){return(0,r.lockVoting)(t)}}]}))}},1282:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getCardBadges=void 0;const o=n(8118),r=n(9731),u=n(1453);e.getCardBadges=function(t,e){return i(this,void 0,void 0,(function*(){if((yield(0,u.getSettings)(t)).useRankedVoting)return[];const n=yield(0,r.hasCurrentMemberVoted)(t);if(yield(0,o.isCurrentMemberAdmin)(t)){const i=yield(0,r.getCardVotes)(t);return i.length?[{text:i.length.toString(),color:n?"blue":null,icon:n?e.images.thumbsUpWhite:e.images.thumbsUp}]:null}return n?[{text:"",color:n?"blue":null,icon:e.images.thumbsUpWhite}]:null}))}},8925:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getCardButtons=void 0;const o=n(9731),r=n(1453);e.getCardButtons=function(t,e){return i(this,void 0,void 0,(function*(){if((yield(0,r.getSettings)(t)).useRankedVoting)return[];const n=yield(0,o.canCurrentMemberVote)(t);return n.canVote?[{icon:e.images.thumbsUp,text:(yield(0,o.hasCurrentMemberVoted)(t))?"Vote ☑":"Vote ☐",callback:function(t){return i(this,void 0,void 0,(function*(){yield(0,o.vote)(t)}))}}]:(console.log(n.errorMsg),[])}))}},9438:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getCardDetailBadges=void 0;const o=n(8118),r=n(9731),u=n(1453);e.getCardDetailBadges=function(t){return i(this,void 0,void 0,(function*(){if((yield(0,u.getSettings)(t)).useRankedVoting)return[];const e=yield(0,r.hasCurrentMemberVoted)(t);if(yield(0,o.isCurrentMemberAdmin)(t)){const n=yield(0,r.getCardVotes)(t);if(!n.length)return null;let i=n.length.toString();return e&&(i+=" (including yours)"),[{text:i,color:e?"blue":null}]}return e?[{text:"Voted",color:e?"blue":null}]:null}))}},1446:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getListActions=void 0;const o=n(1453),r=n(8118),u=n(9731);e.getListActions=function(t){return i(this,void 0,void 0,(function*(){const e=yield(0,o.getSettings)(t),n=yield(0,r.isCurrentMemberAdmin)(t);var i=[];if(e.useRankedVoting){if(!(yield(0,u.canCurrentMemberVote)(t)).canVote)return;i.push({text:"Vote",callback:function(e){return t.modal({url:"rankedVoting.html",title:"Ranked Voting",fullscreen:!0})}}),(e.enableViewOfRankings||n)&&i.push({text:"Ranked Results",callback:function(e){return t.modal({url:"rankedResults.html",fullscreen:!0,title:"Ranked Results"})}})}return n&&i.push({text:"Podium Reveal",callback:function(n){return t.modal({url:e.useRankedVoting?"rankedReveal.html":"reveal.html",fullscreen:!0,title:"Podium Reveal"})}}),i}))}},4782:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getListSorters=void 0;const o=n(8118),r=n(9731);e.getListSorters=function(t){return i(this,void 0,void 0,(function*(){return(yield(0,o.isCurrentMemberAdmin)(t))?[{text:"Most Votes",callback:function(t,e){return i(this,void 0,void 0,(function*(){const n=yield(0,r.getCardsInOrderOfVotes)(t,e.cards);return console.log(JSON.stringify(n)),{sortedIds:n.map((t=>t.id))}}))}}]:[]}))}},7534:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.getShowSettings=void 0;const o=n(8118);e.getShowSettings=function(t){return i(this,void 0,void 0,(function*(){return(yield(0,o.isCurrentMemberAdmin)(t))?t.popup({title:"ShipIt Voting - Settings",url:"settings.html"}):null}))}},1167:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.RankedVotingMethod=void 0,(n=e.RankedVotingMethod||(e.RankedVotingMethod={}))[n.Borda=0]="Borda",n[n.Copeland=1]="Copeland"},8118:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.isCurrentMemberAdmin=void 0,e.isCurrentMemberAdmin=function(t){return n(this,void 0,void 0,(function*(){const e=yield t.member("id"),n=(yield t.board("id","memberships")).memberships.find((t=>t.idMember===e.id));return!!n&&"admin"==n.memberType}))}},1453:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.updateSettings=e.getSettings=e.defaultSettings=void 0;const o=n(1167);e.defaultSettings={maxVotes:3,useRankedVoting:!1,rankedVotingAlgorithm:o.RankedVotingMethod.Copeland,enableViewOfRankings:!1},e.getSettings=function(t){return i(this,void 0,void 0,(function*(){let n=yield t.get("board","shared","settings",e.defaultSettings);return n.enableViewOfRankings||(n.enableViewOfRankings=!1),n}))},e.updateSettings=function(t,e){t.set("board","shared","settings",e)}},9731:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function u(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.isVotingLocked=e.lockVoting=e.getCardsInOrderOfVotes=e.vote=e.hasCurrentMemberVoted=e.canCurrentMemberVote=e.getCardVotes=void 0;const o=n(1453),r="votes",u="voting_locked";function c(t,e){return t.get(e||"card","shared",r,[])}function s(t){return i(this,void 0,void 0,(function*(){const e=yield c(t);if(!e)return!1;const n=yield t.member("id");return e.includes(n.id)}))}function a(t){return i(this,void 0,void 0,(function*(){return d(t)}))}function d(t){return t.get("board","shared",u,!1)}e.getCardVotes=c,e.canCurrentMemberVote=function(t){return i(this,void 0,void 0,(function*(){if(yield a(t))return{canVote:!1,errorMsg:"Voting Locked"};if((yield(0,o.getSettings)(t)).useRankedVoting)return t.memberCanWriteToModel("board")&&t.isMemberSignedIn()?{canVote:!0}:{canVote:!1,errorMsg:"Not a member"};if(!t.memberCanWriteToModel("card")||!t.isMemberSignedIn())return{canVote:!1,errorMsg:"Not a member"};if(yield s(t))return{canVote:!0};const e=(yield t.list("id","cards")).cards.map((t=>t.id)),n=yield function(t,e){return i(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>i(this,void 0,void 0,(function*(){const n=yield c(t,e);if(!n)return 0;const i=t.getContext().member;return n.includes(i)?1:0})))))).reduce(((t,e)=>t+e),0)}))}(t,e),r=n<(yield(0,o.getSettings)(t)).maxVotes;return{canVote:r,errorMsg:r?null:"Too many votes"}}))},e.hasCurrentMemberVoted=s,e.vote=function(t){return i(this,void 0,void 0,(function*(){const e=yield c(t),n=yield t.member("id"),i=e.indexOf(n.id,0);return i>=0?e.splice(i,1):e.push(n.id),yield t.set("card","shared",r,e),!0}))},e.getCardsInOrderOfVotes=function(t,e){return i(this,void 0,void 0,(function*(){if(!e){const n=yield t.list("id","cards");e=n.cards}let n=[];for(const i of e)n.push({id:i.id,title:i.name,votes:(yield c(t,i.id)).length});return n.sort(((t,e)=>t.votes>e.votes?-1:1))}))},e.lockVoting=function(t){return i(this,void 0,void 0,(function*(){const e=yield d(t);yield t.set("board","shared",u,!e)}))},e.isVotingLocked=a}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(()=>{const t=n(8925),e=n(9438),i=n(1282),o=n(7534),r=n(1446),u=n(8435),c=n(4782),s=window.location.href.replace(/\/$/,""),a={baseUrl:s,images:{thumbsUp:`${s}/images/thumbs_up.svg`,thumbsUpWhite:`${s}/images/thumbs_up_white.svg`,lockedBlack:`${s}/images/locked-black.png`,lockedWhite:`${s}/images/locked-white.png`,unlockedBlack:`${s}/images/unlocked-black.png`,unlockedWhite:`${s}/images/unlocked-white.png`}};window.TrelloPowerUp.initialize({"card-buttons":e=>(0,t.getCardButtons)(e,a),"show-settings":t=>(0,o.getShowSettings)(t),"card-detail-badges":t=>(0,e.getCardDetailBadges)(t),"card-badges":t=>(0,i.getCardBadges)(t,a),"list-actions":t=>(0,r.getListActions)(t),"board-buttons":t=>(0,u.getBoardButtons)(t,a),"list-sorters":t=>(0,c.getListSorters)(t)},{helpfulStacks:!0})})()})();