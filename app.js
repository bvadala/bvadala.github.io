(()=>{"use strict";function t(t){return n=this,i=void 0,o=function*(){const n=yield t.member("id"),i=yield t.board("id","memberships");console.log("currentMember: "+JSON.stringify(n)),console.log("board: "+JSON.stringify(i));const e=i.memberships.find((t=>t.id===n.id));return!!e&&"admin"===e.memberType},new((e=void 0)||(e=Promise))((function(t,r){function u(t){try{d(o.next(t))}catch(t){r(t)}}function c(t){try{d(o.throw(t))}catch(t){r(t)}}function d(n){var i;n.done?t(n.value):(i=n.value,i instanceof e?i:new e((function(t){t(i)}))).then(u,c)}d((o=o.apply(n,i||[])).next())}));var n,i,e,o}const n={hideVotes:!1,maxVotes:3};var i=function(t,n,i,e){return new(i||(i=Promise))((function(o,r){function u(t){try{d(e.next(t))}catch(t){r(t)}}function c(t){try{d(e.throw(t))}catch(t){r(t)}}function d(t){var n;t.done?o(t.value):(n=t.value,n instanceof i?n:new i((function(t){t(n)}))).then(u,c)}d((e=e.apply(t,n||[])).next())}))};const e="votes";function o(t,n){return t.get(n||"card","shared",e,[])}function r(t){return i(this,void 0,void 0,(function*(){const n=yield o(t);if(!n)return!1;const i=yield t.member("id");return n.includes(i.id)}))}var u=function(t,n,i,e){return new(i||(i=Promise))((function(o,r){function u(t){try{d(e.next(t))}catch(t){r(t)}}function c(t){try{d(e.throw(t))}catch(t){r(t)}}function d(t){var n;t.done?o(t.value):(n=t.value,n instanceof i?n:new i((function(t){t(n)}))).then(u,c)}d((e=e.apply(t,n||[])).next())}))};const c="https://bvadala.github.io/images";function d(t){return u(this,void 0,void 0,(function*(){return[{icon:`${c}/thumbs_up.svg`,text:(yield r(t))?"Vote      ☑":"Vote      ☐",callback:function(t){return u(this,void 0,void 0,(function*(){(yield function(t){return i(this,void 0,void 0,(function*(){if(yield r(t))return!0;const e=(yield t.list("cards")).cards.map((t=>t.id)),u=yield function(t,n){return i(this,void 0,void 0,(function*(){return(yield Promise.all(n.map((n=>i(this,void 0,void 0,(function*(){const i=yield o(t,n);if(!i)return 0;const e=t.getContext().member;return i.includes(e)?1:0})))))).reduce(((t,n)=>t+n),0)}))}(t,e),c=(yield(t=>t.get("board","shared","settings",n))(t)).maxVotes;return u<c}))}(t))||console.log("too many votes"),yield function(t){return i(this,void 0,void 0,(function*(){const n=yield o(t),i=yield t.member("id"),r=n.indexOf(i.id,0);return r>=0?n.splice(r,1):n.push(i.id),yield t.set("card","shared",e,n),!0}))}(t)}))}}]}))}window.TrelloPowerUp.initialize({"card-buttons":t=>d(t),"show-settings":n=>function(n){return u(this,void 0,void 0,(function*(){return(yield t(n))?n.popup({title:"ShipIt Voting - Settings",url:"settings.html"}):null}))}(n),"card-detail-badges":n=>function(n){return u(this,void 0,void 0,(function*(){const i=yield r(n);if(yield t(n)){const t=yield o(n);return t.length?[{text:t.length.toString(),color:i?"blue":null,icon:`${c}/${i?"thumbs_up_white.svg":"thumbs_up.svg"}`}]:null}return i?[{text:"Voted",color:i?"blue":null,icon:`${c}/thumbs_up_white.svg`}]:null}))}(n)},{appKey:"b445ad95c251c40201f35f25bd3956a2",appName:"ShipIt Voting",helpfulStacks:!0})})();