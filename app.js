(()=>{"use strict";const n={maxVotes:3};var t=function(n,t,e,i){return new(e||(e=Promise))((function(o,c){function r(n){try{l(i.next(n))}catch(n){c(n)}}function u(n){try{l(i.throw(n))}catch(n){c(n)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(r,u)}l((i=i.apply(n,t||[])).next())}))};const e="votes",i="voting_locked";function o(n,t){return n.get(t||"card","shared",e,[])}function c(n){return t(this,void 0,void 0,(function*(){const t=yield o(n);if(!t)return!1;const e=yield n.member("id");return t.includes(e.id)}))}function r(n){return t(this,void 0,void 0,(function*(){return u(n)}))}function u(n){return n.get("board","shared",i,!1)}var l=function(n,t,e,i){return new(e||(e=Promise))((function(o,c){function r(n){try{l(i.next(n))}catch(n){c(n)}}function u(n){try{l(i.throw(n))}catch(n){c(n)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(r,u)}l((i=i.apply(n,t||[])).next())}))};function a(i,u){return l(this,void 0,void 0,(function*(){return[{icon:u.images.thumbsUp,text:(yield c(i))?"Vote      ☑":"Vote      ☐",callback:function(i){return l(this,void 0,void 0,(function*(){(yield function(e){return t(this,void 0,void 0,(function*(){if(yield r(e))return!1;if(!e.memberCanWriteToModel("card")||!e.isMemberSignedIn())return!1;if(yield c(e))return!0;const i=(yield e.list("id","cards")).cards.map((n=>n.id)),u=yield function(n,e){return t(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>t(this,void 0,void 0,(function*(){const t=yield o(n,e);if(!t)return 0;const i=n.getContext().member;return t.includes(i)?1:0})))))).reduce(((n,t)=>n+t),0)}))}(e,i),l=(yield function(t){return t.get("board","shared","settings",n)}(e)).maxVotes;return u<l}))}(i))?yield function(n){return t(this,void 0,void 0,(function*(){const t=yield o(n),i=yield n.member("id"),c=t.indexOf(i.id,0);return c>=0?t.splice(c,1):t.push(i.id),yield n.set("card","shared",e,t),!0}))}(i):console.log("too many votes")}))}}]}))}function d(n){return t=this,e=void 0,o=function*(){const t=yield n.member("id"),e=(yield n.board("id","memberships")).memberships.find((n=>n.idMember===t.id));return!!e&&"admin"==e.memberType},new((i=void 0)||(i=Promise))((function(n,c){function r(n){try{l(o.next(n))}catch(n){c(n)}}function u(n){try{l(o.throw(n))}catch(n){c(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(r,u)}l((o=o.apply(t,e||[])).next())}));var t,e,i,o}function s(n,e){return o=this,c=void 0,a=function*(){if(!(yield d(n)))return[];const o=yield r(n);return[{text:o?"Unlock Voting":"Lock Voting",icon:{dark:o?e.images.lockedWhite:e.images.unlockedWhite,light:o?e.images.lockedBlack:e.images.lockedWhite},callback:function(e){return function(n){return t(this,void 0,void 0,(function*(){const t=yield u(n);yield n.set("board","shared",i,!t)}))}(n)}}]},new((l=void 0)||(l=Promise))((function(n,t){function e(n){try{r(a.next(n))}catch(n){t(n)}}function i(n){try{r(a.throw(n))}catch(n){t(n)}}function r(t){var o;t.done?n(t.value):(o=t.value,o instanceof l?o:new l((function(n){n(o)}))).then(e,i)}r((a=a.apply(o,c||[])).next())}));var o,c,l,a}const f=window.location.href.replace(/\/$/,""),h={baseUrl:f,images:{thumbsUp:`${f}/images/thumbs_up.svg`,thumbsUpWhite:`${f}/images/thumbs_up_white.svg`,lockedBlack:`${f}/images/locked-black.png`,lockedWhite:`${f}/images/locked-white.png`,unlockedBlack:`${f}/images/unlocked-black.png`,unlockedWhite:`${f}/images/unlocked-white.png`}};window.TrelloPowerUp.initialize({"card-buttons":n=>a(n,h),"show-settings":n=>function(n){return t=this,e=void 0,o=function*(){return(yield d(n))?n.popup({title:"ShipIt Voting - Settings",url:"settings.html"}):null},new((i=void 0)||(i=Promise))((function(n,c){function r(n){try{l(o.next(n))}catch(n){c(n)}}function u(n){try{l(o.throw(n))}catch(n){c(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(r,u)}l((o=o.apply(t,e||[])).next())}));var t,e,i,o}(n),"card-detail-badges":n=>function(n){return t=this,e=void 0,r=function*(){const t=yield c(n);if(yield d(n)){const e=yield o(n);if(!e.length)return null;let i=e.length.toString();return t&&(i+=" (including yours)"),[{text:i,color:t?"blue":null}]}return t?[{text:"Voted",color:t?"blue":null}]:null},new((i=void 0)||(i=Promise))((function(n,o){function c(n){try{l(r.next(n))}catch(n){o(n)}}function u(n){try{l(r.throw(n))}catch(n){o(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(c,u)}l((r=r.apply(t,e||[])).next())}));var t,e,i,r}(n),"card-badges":n=>function(n,t){return e=this,i=void 0,u=function*(){const e=yield c(n);if(yield d(n)){const i=yield o(n);return i.length?[{text:i.length.toString(),color:e?"blue":null,icon:e?t.images.thumbsUpWhite:t.images.thumbsUp}]:null}return e?[{text:"",color:e?"blue":null,icon:t.images.thumbsUpWhite}]:null},new((r=void 0)||(r=Promise))((function(n,t){function o(n){try{l(u.next(n))}catch(n){t(n)}}function c(n){try{l(u.throw(n))}catch(n){t(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(n){n(e)}))).then(o,c)}l((u=u.apply(e,i||[])).next())}));var e,i,r,u}(n,h),"list-actions":n=>function(n){return t=this,e=void 0,o=function*(){return(yield d)?[{text:"Podium Reveal",callback:function(t){return n.modal({url:"reveal.html",fullscreen:!0,title:"Podium Reveal"})}}]:[]},new((i=void 0)||(i=Promise))((function(n,c){function r(n){try{l(o.next(n))}catch(n){c(n)}}function u(n){try{l(o.throw(n))}catch(n){c(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(r,u)}l((o=o.apply(t,e||[])).next())}));var t,e,i,o}(n),"board-buttons":n=>s(n,h)},{helpfulStacks:!0})})();