(()=>{"use strict";const t={hideVotes:!1,maxVotes:3};var n=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function c(t){try{u(i.next(t))}catch(t){r(t)}}function s(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,s)}u((i=i.apply(t,n||[])).next())}))};const e="votes",i=(t,n)=>t.get(n||"card","shared",e,[]);function o(t){return n(this,void 0,void 0,(function*(){console.log("getting card votes");const n=yield i(t);if(!n)return!1;console.log("getting current member");const e=yield t.member("id");return n.includes(e.id)}))}var r=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function c(t){try{u(i.next(t))}catch(t){r(t)}}function s(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,s)}u((i=i.apply(t,n||[])).next())}))};function c(c){return r(this,void 0,void 0,(function*(){const s=yield c.board("id","memberships");return console.log(JSON.stringify(s.memberships)),[{icon:"https://bvadala.github.io/images/thumbs_up.svg",text:(yield o(c))?"Vote ☑":"Vote ☐",callback:function(c){return r(this,void 0,void 0,(function*(){(yield function(e){return n(this,void 0,void 0,(function*(){if(yield o(e))return!0;const r=(yield e.list("cards")).cards.map((t=>t.id)),c=yield function(t,e){return n(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>n(this,void 0,void 0,(function*(){const n=yield i(t,e);if(!n)return 0;const o=t.getContext().member;return n.includes(o)?1:0})))))).reduce(((t,n)=>t+n),0)}))}(e,r),s=(yield(n=>n.get("board","shared","settings",t))(e)).maxVotes;return c<s}))}(c))||console.log("too many votes"),yield function(t){return n(this,void 0,void 0,(function*(){const n=yield i(t),o=yield t.member("id"),r=n.indexOf(o.id,0);return r>=0?n.splice(r,1):n.push(o.id),yield t.set("card","shared",e,n),!0}))}(c)}))}}]}))}window.TrelloPowerUp.initialize({"card-buttons":t=>c(t),"show-settings":t=>function(t){return t.popup({title:"ShipIt Voting - Settings",url:"settings.html"})}(t)},{appKey:"b445ad95c251c40201f35f25bd3956a2",appName:"ShipIt Voting",helpfulStacks:!0})})();