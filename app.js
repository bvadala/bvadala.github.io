(()=>{"use strict";const t={hideVotes:!1,maxVotes:3};var e=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{u(i.next(t))}catch(t){r(t)}}function s(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((i=i.apply(t,e||[])).next())}))};const n="votes",i=(t,e)=>t.get(e||"card","shared",n,[]);function o(t){return e(this,void 0,void 0,(function*(){console.log("getting card votes");const e=yield i(t);if(!e)return!1;console.log("getting current member");const n=yield t.member("id");return e.includes(n.id)}))}var r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{u(i.next(t))}catch(t){r(t)}}function s(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((i=i.apply(t,e||[])).next())}))};function c(c){return r(this,void 0,void 0,(function*(){const u=yield c.getRestApi(),d=yield u.getToken();return console.log("token: "+d),console.log(JSON.stringify(s(u))),[{icon:"https://bvadala.github.io/images/thumbs_up.svg",text:(yield o(c))?"Vote ☑":"Vote ☐",callback:function(c){return r(this,void 0,void 0,(function*(){(yield function(n){return e(this,void 0,void 0,(function*(){if(yield o(n))return!0;const r=(yield n.list("cards")).cards.map((t=>t.id)),c=yield function(t,n){return e(this,void 0,void 0,(function*(){return(yield Promise.all(n.map((n=>e(this,void 0,void 0,(function*(){const e=yield i(t,n);if(!e)return 0;const o=t.getContext().member;return e.includes(o)?1:0})))))).reduce(((t,e)=>t+e),0)}))}(n,r),s=(yield(e=>e.get("board","shared","settings",t))(n)).maxVotes;return c<s}))}(c))||console.log("too many votes"),yield function(t){return e(this,void 0,void 0,(function*(){const e=yield i(t),o=yield t.member("id"),r=e.indexOf(o.id,0);return r>=0?e.splice(r,1):e.push(o.id),yield t.set("card","shared",n,e),!0}))}(c)}))}}]}))}const s=t=>{let e=new Set,n=t;do{Object.getOwnPropertyNames(n).map((t=>e.add(t)))}while(n=Object.getPrototypeOf(n));return[...e.keys()].filter((e=>"function"==typeof t[e]))};window.TrelloPowerUp.initialize({"card-buttons":t=>c(t),"show-settings":t=>function(t){return t.popup({title:"ShipIt Voting - Settings",url:"settings.html"})}(t)},{appKey:"b445ad95c251c40201f35f25bd3956a2",appName:"ShipIt Voting",helpfulStacks:!0})})();