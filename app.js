(()=>{"use strict";function t(t){return n=this,e=void 0,o=function*(){const n=yield t.member("id"),e=(yield t.board("id","memberships")).memberships.find((t=>t.id===n.id));return!!e&&"admin"===e.memberType},new((i=void 0)||(i=Promise))((function(t,r){function u(t){try{d(o.next(t))}catch(t){r(t)}}function c(t){try{d(o.throw(t))}catch(t){r(t)}}function d(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(u,c)}d((o=o.apply(n,e||[])).next())}));var n,e,i,o}const n={hideVotes:!1,maxVotes:3};var e=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function u(t){try{d(i.next(t))}catch(t){r(t)}}function c(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,c)}d((i=i.apply(t,n||[])).next())}))};const i="votes";function o(t,n){return t.get(n||"card","shared",i,[])}function r(t){return e(this,void 0,void 0,(function*(){console.log("getting card votes");const n=yield o(t);if(!n)return!1;console.log("getting current member");const e=yield t.member("id");return n.includes(e.id)}))}var u=function(t,n,e,i){return new(e||(e=Promise))((function(o,r){function u(t){try{d(i.next(t))}catch(t){r(t)}}function c(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,c)}d((i=i.apply(t,n||[])).next())}))};const c="https://bvadala.github.io/images";function d(t){return u(this,void 0,void 0,(function*(){return[{icon:`${c}/thumbs_up.svg`,text:(yield r(t))?"Vote      ☑":"Vote      ☐",callback:function(t){return u(this,void 0,void 0,(function*(){(yield function(t){return e(this,void 0,void 0,(function*(){if(yield r(t))return!0;const i=(yield t.list("cards")).cards.map((t=>t.id)),u=yield function(t,n){return e(this,void 0,void 0,(function*(){return(yield Promise.all(n.map((n=>e(this,void 0,void 0,(function*(){const e=yield o(t,n);if(!e)return 0;const i=t.getContext().member;return e.includes(i)?1:0})))))).reduce(((t,n)=>t+n),0)}))}(t,i),c=(yield(t=>t.get("board","shared","settings",n))(t)).maxVotes;return u<c}))}(t))||console.log("too many votes"),yield function(t){return e(this,void 0,void 0,(function*(){const n=yield o(t),e=yield t.member("id"),r=n.indexOf(e.id,0);return r>=0?n.splice(r,1):n.push(e.id),yield t.set("card","shared",i,n),!0}))}(t)}))}}]}))}window.TrelloPowerUp.initialize({"card-buttons":t=>d(t),"show-settings":n=>function(n){return u(this,void 0,void 0,(function*(){return(yield t(n))?n.popup({title:"ShipIt Voting - Settings",url:"settings.html"}):null}))}(n),"card-detail-badges":n=>function(n){return u(this,void 0,void 0,(function*(){const e=yield r(n);if(yield t(n)){const t=yield o(n);return t.length?[{text:t.length.toString(),color:e?"blue":null,icon:`${c}/${e?"thumbs_up_white.svg":"thumbs_up.svg"}`}]:null}return e?[{text:"Voted",color:e?"blue":null,icon:`${c}/${e?"thumbs_up_white.svg":"thumbs_up.svg"}`}]:null}))}(n)},{appKey:"b445ad95c251c40201f35f25bd3956a2",appName:"ShipIt Voting",helpfulStacks:!0})})();