(()=>{"use strict";const n={hideVotes:!1,maxVotes:3};var t=function(n,t,e,i){return new(e||(e=Promise))((function(o,r){function u(n){try{l(i.next(n))}catch(n){r(n)}}function c(n){try{l(i.throw(n))}catch(n){r(n)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,c)}l((i=i.apply(n,t||[])).next())}))};const e="votes";function i(n,t){return n.get(t||"card","shared",e,[])}function o(n){return t(this,void 0,void 0,(function*(){const t=yield i(n);if(!t)return!1;const e=yield n.member("id");return t.includes(e.id)}))}var r=function(n,t,e,i){return new(e||(e=Promise))((function(o,r){function u(n){try{l(i.next(n))}catch(n){r(n)}}function c(n){try{l(i.throw(n))}catch(n){r(n)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,c)}l((i=i.apply(n,t||[])).next())}))};function u(u,c){return r(this,void 0,void 0,(function*(){return[{icon:c.images.thumbsUp,text:(yield o(u))?"Vote      ☑":"Vote      ☐",callback:function(u){return r(this,void 0,void 0,(function*(){(yield function(e){return t(this,void 0,void 0,(function*(){if(yield o(e))return!0;const r=(yield e.list("cards")).cards.map((n=>n.id)),u=yield function(n,e){return t(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>t(this,void 0,void 0,(function*(){const t=yield i(n,e);if(!t)return 0;const o=n.getContext().member;return t.includes(o)?1:0})))))).reduce(((n,t)=>n+t),0)}))}(e,r),c=(yield function(t){return t.get("board","shared","settings",n)}(e)).maxVotes;return u<c}))}(u))?yield function(n){return t(this,void 0,void 0,(function*(){const t=yield i(n),o=yield n.member("id"),r=t.indexOf(o.id,0);return r>=0?t.splice(r,1):t.push(o.id),yield n.set("card","shared",e,t),!0}))}(u):console.log("too many votes")}))}}]}))}function c(n){return t=this,e=void 0,o=function*(){const t=yield n.member("id"),e=(yield n.board("id","memberships")).memberships.find((n=>n.idMember===t.id));return!!e&&"admin"==e.memberType},new((i=void 0)||(i=Promise))((function(n,r){function u(n){try{l(o.next(n))}catch(n){r(n)}}function c(n){try{l(o.throw(n))}catch(n){r(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(u,c)}l((o=o.apply(t,e||[])).next())}));var t,e,i,o}const l=window.location.href.replace(/\/$/,""),s={baseUrl:l,images:{thumbsUp:`${l}/images/thumbs_up.svg`,thumbsUpWhite:`${l}/images/thumbs_up_white.svg`}};window.TrelloPowerUp.initialize({"card-buttons":n=>u(n,s),"show-settings":n=>function(n){return t=this,e=void 0,o=function*(){return(yield c(n))?n.popup({title:"ShipIt Voting - Settings",url:"settings.html"}):null},new((i=void 0)||(i=Promise))((function(n,r){function u(n){try{l(o.next(n))}catch(n){r(n)}}function c(n){try{l(o.throw(n))}catch(n){r(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(n){n(e)}))).then(u,c)}l((o=o.apply(t,e||[])).next())}));var t,e,i,o}(n),"card-detail-badges":n=>function(n){return t=this,e=void 0,u=function*(){const t=yield o(n);if(yield c(n)){const e=yield i(n);return e.length?[{text:e.length.toString(),color:t?"blue":null}]:null}return t?[{text:"Voted",color:t?"blue":null}]:null},new((r=void 0)||(r=Promise))((function(n,i){function o(n){try{l(u.next(n))}catch(n){i(n)}}function c(n){try{l(u.throw(n))}catch(n){i(n)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(n){n(e)}))).then(o,c)}l((u=u.apply(t,e||[])).next())}));var t,e,r,u}(n),"card-badges":n=>function(n,t){return e=this,r=void 0,l=function*(){const e=yield o(n);if(yield c(n)){const o=yield i(n);return o.length?[{text:o.length.toString(),color:e?"blue":null,icon:e?t.images.thumbsUpWhite:t.images.thumbsUp}]:null}return e?[{text:"",color:e?"blue":null,icon:t.images.thumbsUpWhite}]:null},new((u=void 0)||(u=Promise))((function(n,t){function i(n){try{c(l.next(n))}catch(n){t(n)}}function o(n){try{c(l.throw(n))}catch(n){t(n)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof u?e:new u((function(n){n(e)}))).then(i,o)}c((l=l.apply(e,r||[])).next())}));var e,r,u,l}(n,s)},{helpfulStacks:!0})})();