(()=>{"use strict";var e={1167:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.RankedVotingMethod=void 0,(n=t.RankedVotingMethod||(t.RankedVotingMethod={}))[n.Borda=0]="Borda",n[n.Copeland=1]="Copeland"},1308:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function d(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9731),r=window.TrelloPowerUp.iframe();r.render((function(){!function(e){i(this,void 0,void 0,(function*(){const t=yield(0,o.getCardsInOrderOfVotes)(e),n=$("#firstPlaceName"),i=$("#secondPlaceName"),r=$("#thirdPlaceName");n.prop("innerHTML",t[0].title),i.prop("innerHTML",t[1].title),r.prop("innerHTML",t[2].title);let d=document.querySelector("#resultsBody"),s=1;for(let e of t){let t=d.insertRow();t.insertCell().appendChild(document.createTextNode(s.toString())),s++,t.insertCell().appendChild(document.createTextNode(e.title)),t.insertCell().appendChild(document.createTextNode(e.votes.toString()))}}))}(r)}))},1453:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function d(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateSettings=t.getSettings=t.defaultSettings=void 0;const o=n(1167);t.defaultSettings={maxVotes:3,useRankedVoting:!1,rankedVotingAlgorithm:o.RankedVotingMethod.Copeland,enableViewOfRankings:!1},t.getSettings=function(e){return i(this,void 0,void 0,(function*(){let n=yield e.get("board","shared","settings",t.defaultSettings);return n.enableViewOfRankings||(n.enableViewOfRankings=!1),n}))},t.updateSettings=function(e,t){e.set("board","shared","settings",t)}},9731:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function d(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isVotingLocked=t.lockVoting=t.getCardsInOrderOfVotes=t.vote=t.hasCurrentMemberVoted=t.canCurrentMemberVote=t.getCardVotes=void 0;const o=n(1453),r="votes",d="voting_locked";function s(e,t){return e.get(t||"card","shared",r,[])}function a(e){return i(this,void 0,void 0,(function*(){const t=yield s(e);if(!t)return!1;const n=yield e.member("id");return t.includes(n.id)}))}function c(e){return i(this,void 0,void 0,(function*(){return u(e)}))}function u(e){return e.get("board","shared",d,!1)}t.getCardVotes=s,t.canCurrentMemberVote=function(e){return i(this,void 0,void 0,(function*(){if(yield c(e))return{canVote:!1,errorMsg:"Voting Locked"};if((yield(0,o.getSettings)(e)).useRankedVoting)return e.memberCanWriteToModel("board")&&e.isMemberSignedIn()?{canVote:!0}:{canVote:!1,errorMsg:"Not a member"};if(!e.memberCanWriteToModel("card")||!e.isMemberSignedIn())return{canVote:!1,errorMsg:"Not a member"};if(yield a(e))return{canVote:!0};const t=(yield e.list("id","cards")).cards.map((e=>e.id)),n=yield function(e,t){return i(this,void 0,void 0,(function*(){return(yield Promise.all(t.map((t=>i(this,void 0,void 0,(function*(){const n=yield s(e,t);if(!n)return 0;const i=e.getContext().member;return n.includes(i)?1:0})))))).reduce(((e,t)=>e+t),0)}))}(e,t),r=n<(yield(0,o.getSettings)(e)).maxVotes;return{canVote:r,errorMsg:r?null:"Too many votes"}}))},t.hasCurrentMemberVoted=a,t.vote=function(e){return i(this,void 0,void 0,(function*(){const t=yield s(e),n=yield e.member("id"),i=t.indexOf(n.id,0);return i>=0?t.splice(i,1):t.push(n.id),yield e.set("card","shared",r,t),!0}))},t.getCardsInOrderOfVotes=function(e,t){return i(this,void 0,void 0,(function*(){if(!t){const n=yield e.list("id","cards");t=n.cards}let n=[];for(const i of t)n.push({id:i.id,title:i.name,votes:(yield s(e,i.id)).length});return n.sort(((e,t)=>e.votes>t.votes?-1:1))}))},t.lockVoting=function(e){return i(this,void 0,void 0,(function*(){const t=yield u(e);yield e.set("board","shared",d,!t)}))},t.isVotingLocked=c}},t={};!function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}(1308)})();